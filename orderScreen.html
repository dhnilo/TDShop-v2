<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/orderScreen.css" rel="stylesheet">
    <script src="js/logout.js"></script>
    <title>Your Order</title>
</head>
<body>
    <header class="black-header">
        <div class="containerNav">
            <div class="logo-container">
                <a class="navbar-brand" href="homeScreen.html"><img src="images/shop.webp" alt="TD Shop Logo" class="logo"></a>
                <h1 class="company-name">TD Shop</h1>
            </div>
            <div class="search-container">
                <form class="search-form">
                    <input type="text" placeholder="Search">
                    <button class="myButton fancyButton" type="submit">Search</button>
                </form>
                <div class="profile-dropdown">
                    <button class="profile-button">User</button>
                    <div class="dropdown-content">
                        <a href="profileScreen.html">View Profile</a>
                        <a href="loginScreen.html" onclick="logout()">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <br>
    <div class="container">
        <div class="order">
            <h1 class="title">Your Order ID: __number___ </h1>
            <table>
                <thead>
                    <tr>
                        <th class="whiteText">Product</th>
                        <th class="whiteText">Price</th>
                        <th class="whiteText">Quantity</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div class="orderSummary">
            <h1 class="purpleTitle">Order Summary</h1>
            <div class="theSubtotal">
                <!-- java script inserts subtotal here -->
            </div>
            <div class="orderSeparator"></div>
            <div class="theShipping">
                <!-- java script inserts subtotal here -->
            </div>
            <div class="orderSeparator"></div>
            <div class="theTax">
                <!-- java script inserts subtotal here -->
            </div>
            <div class="orderSeparator"></div>
            <div class="theTotal">
                <!-- java script inserts subtotal here -->
            </div>
            <div class="orderSeparator"></div>
            <button type="button" onclick="submitForm()">Put PayPal here</button>
        </div>
    </div>
    <script>
        // Fetch the cart and shipping information
        var cart = JSON.parse(localStorage.getItem('cart'));
        var shippingInfo = JSON.parse(localStorage.getItem('shippingInfo'));

        // Create the order object
        var order = {
            _id: f,
            userId: localStorage.getItem('userId'),
            orderItems: cart,
            shippingInfo: shippingInfo,
            isPaid: false
        };

        // Get the shipping information section, order table, and order summary
        var shippingInfoSection = document.querySelector('.shipping-info');
        var orderTable = document.querySelector('.order table');
        var orderSummary = document.querySelector('.order-summary');

        var mySubtotal = document.querySelector('.theSubtotal');
        var myShipping = document.querySelector('.theShipping');
        var myTax = document.querySelector('.theTax');
        var myTotal = document.querySelector('.theTotal');

        // Initialize the item price
        var itemPrice = 0;

        // For each item in the order
        order.items.forEach(item => {
            // Create a table row
            var row = document.createElement('tr');
            row.innerHTML = `
    <td><img src="${item.image}" alt="${item.title}"></td>
    <td>${item.title}</td>
    <td>${item.price}</td>
    <div class"orderSeparator" style="height: 1px;
    background-color: gray;
    margin: 10px 0;"></div>
  `;

            // Add the table row to the order table
            orderTable.appendChild(row);

            // Update the item price
            itemPrice += item.price * item.quantity;
        });

        // Calculate the shipping price, tax, and total price
        var shippingPrice = itemPrice < 50 ? itemPrice * 0.05 : 0;
        var tax = itemPrice * 0.1;
        var totalPrice = itemPrice + shippingPrice + tax;

        // Update the HTML of the shipping information section
        shippingInfoSection.innerHTML = `
  <p>Address: ${order.shippingInfo.address}</p>
  <p>City: ${order.shippingInfo.city}</p>
  <p>Postal Code: ${order.shippingInfo.postalCode}</p>
  <p>Country: ${order.shippingInfo.country}</p>
`;

mySubtotal.innerHTML = `
        <p>Subtotal: 
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;
            $${itemPrice.toFixed(2)}</p>
        `;
myShipping.innerHTML = `
        <p>Shipping: 
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;
            $${shippingPrice.toFixed(2)}</p>
        `;
myTax.innerHTML = `
        <p>Tax: 
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;
            $${tax.toFixed(2)}</p>
        `;
myTotal.innerHTML = `
        <p>Total: 
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;
            $${totalPrice.toFixed(2)}</p>
        `;
    

        /*// Update the HTML of the order summary
        orderSummary.innerHTML = `
  <p>Item price: ${itemPrice}</p>
  <p>Shipping price: ${shippingPrice}</p>
  <p>Tax: ${tax}</p>
  <p>Total price: ${totalPrice}</p>
`;*/
// Add a click event listener to the logout button
const logoutButton = document.getElementById('logout');
if (logoutButton) {
  logoutButton.addEventListener('click', function () {
    // Clear the login status
    localStorage.setItem('isLoggedIn', false);
    clearCart();
    // Refresh the page
    location.reload();
  });
}
    </script>
</body>

</html>