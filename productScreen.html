<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TD Shop</title>
  <link href="css/productScreen.css" rel="stylesheet">
</head>
<body>
  <header class="black-header">
    <div class="container">
        <div class="logo-container">
            <a class="navbar-brand" href="homeScreen.html"><img src="images/shop.webp" alt="TD Shop Logo" class="logo"></a>
            <h1 class="company-name">TD Shop</h1>
        </div>
        <div class="search-container">
            <form class="search-form">
                <input type="text" placeholder="Search">
                <button class="myButton fancyButton" type="submit">Search</button>
            </form>
            <button class="myButton" style="margin-right: 15px;margin-left: -10px;"onclick="location.href='cartScreen.html'">Cart</button>
            <div class="profile-dropdown">
                <button class="profile-button">User</button>
                <div class="dropdown-content">
                    <a href="profileScreen.html">View Profile</a>
                    <a href="loginScreen.html">Logout</a>
                </div>
            </div>
        </div>
    </div>
  </header>
  <main>
    <a href="homeScreen.html">
      <button class="backButton">
        Back to Home
      </button>
    </a>
    <div id="product-container" class="product-screen" style="margin-left: 10vw;">
      <div id="card-flex" class="product-screen">
        <h1 id="product-name" class="title"></h1>
        <div id="content-container" class="product-screen">
          <img class="img-fit" src="" id="product-image">
          <div id="product-details-container" class='product-screen'>
            <p id="product-description" class="whiteText"></p>
            <p id="product-price" class="whiteText"></p>
            <p id="product-rating" class="whiteText"></p>
            <p id="product-count-in-stock" class="whiteText"></p>
            <input type="number" id="product-qty" min="1" placeholder="1">
            <button class="addCartButton" onclick="addToCart()" id="add-to-cart-button">Add to Cart</button>
          </div>
        </div>
      </div>
    </div>
    <footer class="p-footer-color">
      <p>Â©2023 TD-Shop</p>
  </footer>
    <script>
      console.log('hello');

      window.onload = function () {
        const id = getProductIdFromUrl();
        fetchProduct(id);
      };

      function getProductIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('id');
      }

      function fetchProduct(productId) {
        fetch('index.php?id=' + productId)
          .then(response => response.json())
          .then(product => {
            console.log(product);
            displayProduct(product);
          });
      }

      function displayProduct(product) {
        const productName = document.getElementById('product-name');
        const productImage = document.getElementById('product-image');
        const productDescription = document.getElementById('product-description');
        const productPrice = document.getElementById('product-price');

        if (productName) {
          productName.textContent = product.name;
        }

        if (productImage) {
          productImage.src = product.image;
        }

        if (productDescription) {
          productDescription.textContent = product.description;
        }

        if (productPrice) {
          productPrice.textContent = `$${product.price}`;
        }
      }
    </script>
    <script>
      function addToCart() {
        const id = getProductIdFromUrl();
        let qty = document.getElementById('product-qty').value;
        qty = qty && !isNaN(qty) ? Number(qty) : 1;
        const cart = getCart();
        const existingItem = cart.find(item => item.id == id);
        if (existingItem) {
          existingItem.qty += qty;
        } else {
          cart.push({
            id: id,
            qty: qty
          });
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        alert('Added to cart');
      }

      function getCart() {
        const cart = localStorage.getItem('cart');
        if (cart) {
          return JSON.parse(cart);
        } else {
          return [];
        }
      }
    </script>
  </main>
</body>

</html>