<!DOCTYPE html>
<html>

<head>
    <title>TD Shop</title>
    <link href="css/index.css" rel="stylesheet">
    <script src="products.js" type="module"></script>
    <script src="index.js" type="module"></script>
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="homeScreen.html"><img src="images/shop.webp" alt="TD Shop" class="logo">TD
                    Shop</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="nav-align" id="navbarSupportedContent">
                    <form id="searchForm" class="d-flex">
                        <input id="searchInput" class="form-control me-2" type="search" placeholder="Search"
                            aria-label="Search">
                        <button class="btn btn-outline-success" type="submit">Search</button>
                    </form>
                    <div class="dropdown" style="float:right;">
                        <button class="btn btn-light" id="dropdown-button">USER</button>
                        <div class="dropdown-content" id="dropdown-content">
                            <a href="#">Profile Tab</a>
                            <a href="#">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div id="products">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script>
                var products = [];

                $(document).ready(function () {
                    $.ajax({
                        url: "index.php",
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            products = data;
                            updateProductList(products); // Call your function to display the products
                        },
                        error: function (error) {
                            console.log("Error: ", error);
                        }
                    });
                });

                function updateProductList(products) {
                    const productsSection = document.getElementById('products');
                    productsSection.innerHTML = '';
                    products.forEach(addProductToPage);
                }

                function addProductToPage(product) {
                    var productsSection = document.getElementById('products');

                    var productDiv = document.createElement('div');
                    productDiv.className = 'product';

                    var productImage = document.createElement('img');
                    productImage.src = product.image;
                    productDiv.appendChild(productImage);
                    productImage.className = 'img-fit';

                    var productName = document.createElement('h2');
                    productName.textContent = product.name;
                    productDiv.appendChild(productName);
                    productName.className = 'title';

                    var productDescription = document.createElement('p');
                    productDescription.textContent = product.description;
                    productDiv.appendChild(productDescription);
                    productDescription.className = 'whiteText';

                    var productPrice = document.createElement('p');
                    productPrice.textContent = `Price: $${product.price}`;
                    productDiv.appendChild(productPrice);
                    productPrice.className = 'whiteText';

                    const addToCartButton = document.createElement('button');
                    addToCartButton.textContent = 'Add to Cart';
                    productDiv.appendChild(addToCartButton);
                    addToCartButton.className = 'myButton';

                    productsSection.appendChild(productDiv);
                }

                // Add event listener to the search form
                var searchForm = document.getElementById('searchForm');
                if (searchForm) {
                    searchForm.addEventListener('submit', function (event) {
                        event.preventDefault(); // Prevent the form from being submitted
                        var query = document.getElementById('searchInput').value;
                        search(query);
                    });
                }

                function search(query) {
                    const filteredProducts = products.filter(product =>
                        product.category.toLowerCase().includes(query.toLowerCase()) ||
                        product.name.toLowerCase().includes(query.toLowerCase())
                    );
                    updateProductList(filteredProducts);
                }
            </script>
        </div>
    </main>
    <footer>
        <table>
            <tr>
                <td class="p-footer-color">
                    <p>Â©2023 TD-Shop</p>
                </td>
            </tr>
        </table>
    </footer>
</body>

</html>